Refactor code according to a proper architecture (MVVM or something)

